machine:
  python:
    version: 3.6.1

dependencies:
  cache_directories:
    - env/

  override:
    - pip install -U bootstrapper pip wheel
    - make
    - make setup-pyenv

  pre:
    - sudo apt-get install -y language-pack-uk

test:
  override:
    - TEST_ARGS="--with-xunit --cover-html --cover-html-dir=$CIRCLE_ARTIFACTS/coverage" make test

  post:
    - make coveralls
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - "[ -r nosetests.xml ] && mv nosetests.xml $CIRCLE_TEST_REPORTS/junit/ || :"

deployment:
  release:
    tag: /v\d+.\d+.\d+.*/
    commands:
      - make deploy
